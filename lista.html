<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ranking ON</title>

<style>
:root{
  --red:#e50914;
  --cyan:#19d3ff;
  --yellow:#ffc400;
  --green:#2bdc63;
  --glass:rgba(0,0,0,.55);
  --border:rgba(255,255,255,.08);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:#fff;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.75)),
    url("fondoranking2.jpg") center/cover fixed;
}

/* ================= HEADER RECTANGULAR ================= */

.headerBox{
  margin:18px 14px 10px;
  padding:16px;
  border-radius:22px;
  background:linear-gradient(180deg, rgba(0,0,0,.75), rgba(0,0,0,.5));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 20px 40px rgba(0,0,0,.45);
  display:grid;
  grid-template-columns:80px 1fr 60px;
  align-items:center;
  backdrop-filter:blur(8px);
}

.logo{
  width:70px;
}

.titleMain{
  margin:0;
  text-align:center;
  font-family:"Benjamin Gothic Heavy",Impact,"Arial Black";
  font-size:clamp(26px,4vw,42px);
  letter-spacing:3px;
}

.titleMain .white{color:#fff}
.titleMain .red{color:var(--red)}

.titleSub{
  text-align:center;
  margin-top:6px;
  font-weight:900;
  letter-spacing:2px;
  color:var(--cyan);
  text-shadow:0 0 14px rgba(25,211,255,.4);
  font-size:clamp(14px,2vw,20px);
}

.arrowDown{
  width:0;height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-top:22px solid var(--red);
  animation:arrowMove 1.6s ease-in-out infinite,
            arrowBlink 1.6s ease-in-out infinite;
  justify-self:center;
}

@keyframes arrowMove{
  0%{transform:translateY(0)}
  50%{transform:translateY(10px)}
  100%{transform:translateY(0)}
}
@keyframes arrowBlink{
  0%{opacity:1}
  50%{opacity:.6}
  100%{opacity:1}
}

/* ================= LISTA ================= */

.list{
  padding:10px 14px 40px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.row{
  display:grid;
  grid-template-columns:55px 50px 1fr 20px 110px;
  align-items:center;
  gap:10px;
  padding:14px;
  border-radius:18px;
  background:var(--glass);
  border:1px solid var(--border);
  box-shadow:0 16px 32px rgba(0,0,0,.4);
  backdrop-filter:blur(6px);
}

.row.top1{
  border:1px solid rgba(229,9,20,.4);
  box-shadow:0 0 20px rgba(229,9,20,.2);
}

.num{
  font-family:"Benjamin Gothic Heavy",Impact,"Arial Black";
  font-size:36px;
  text-align:center;
}
.row.top1 .num{
  font-size:44px;
  color:var(--red);
}

/* Play */
.play{
  width:46px;height:46px;
  border-radius:50%;
  border:2px solid #fff;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
.play svg{
  fill:#fff;
  width:18px;
}

/* Info */
.song{
  font-weight:900;
  font-size:18px;
  margin:0;
}
.artist{
  margin:4px 0 0;
  font-size:14px;
  opacity:.8;
}

/* Trend */
.trend.stable{
  background:var(--yellow);
  width:14px;height:14px;
  border-radius:3px;
}

/* Votar */
.vote{
  width:110px;
  height:44px;
  border:0;
  border-radius:14px;
  background:var(--red);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}
.vote:disabled{
  opacity:.4;
  cursor:not-allowed;
}

.footer{
  text-align:center;
  padding:10px 0 20px;
  font-weight:700;
  opacity:.8;
}
</style>
</head>
<body>

<div class="headerBox">
  <img src="logotipo.png" class="logo">
  <div>
    <h1 class="titleMain">
      <span class="white">RANKING</span> 
      <span class="red">ON!</span>
    </h1>
    <div class="titleSub">VOTÁ TU TEMA PREFERIDO</div>
  </div>
  <div class="arrowDown"></div>
</div>

<div class="list" id="list"></div>
<div class="footer">www.laonradio.com.ar</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC8XX...",
  authDomain: "on-radio-ranking.firebaseapp.com",
  databaseURL: "https://on-radio-ranking-default-rtdb.firebaseio.com",
  projectId: "on-radio-ranking",
  storageBucket: "on-radio-ranking.appspot.com",
  messagingSenderId: "311635352358",
  appId: "1:311635352358:web:257ff4821987f07d31ffe7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const temasRef = ref(db,"temas");
const list = document.getElementById("list");

const audio = new Audio();
let currentButton = null;

function today(){
  return new Date().toISOString().slice(0,10);
}
function votedToday(){
  return localStorage.getItem("on_vote")==today();
}
function lockVote(){
  localStorage.setItem("on_vote",today());
}

function playIcon(){
  return <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>;
}
function pauseIcon(){
  return <svg viewBox="0 0 24 24"><path d="M6 5h4v14H6zm8 0h4v14h-4z"/></svg>;
}

onValue(temasRef,(snap)=>{
  const data=snap.val();
  if(!data) return;

  const temas=Object.entries(data).map(([id,t])=>({
    id,
    nombre:t.nombre,
    artista:t.artista,
    audio:t.audio,
    votos:Number(t.votos||0)
  }));

  temas.sort((a,b)=>b.votos-a.votos);
  list.innerHTML="";

  temas.forEach((t,i)=>{
    const row=document.createElement("div");
    row.className="row"+(i===0?" top1":"");

    row.innerHTML=`
      <div class="num">${i+1}</div>
      <div class="play">${playIcon()}</div>
      <div>
        <p class="song">${t.nombre}</p>
        <p class="artist">${t.artista}</p>
      </div>
      <div class="trend stable"></div>
      <button class="vote" ${votedToday()?"disabled":""}>VOTAR</button>
    `;

    const playBtn=row.querySelector(".play");

    playBtn.onclick=()=>{
      if(audio.src===t.audio && !audio.paused){
        audio.pause();
        playBtn.innerHTML=playIcon();
        return;
      }

      if(currentButton){
        currentButton.innerHTML=playIcon();
      }

      audio.src=t.audio;
      audio.play();
      playBtn.innerHTML=pauseIcon();
      currentButton=playBtn;
    };

    row.querySelector(".vote").onclick=async()=>{
      if(votedToday()){
        alert("Ya votaste hoy. Volvé mañana.");
        return;
      }
      await runTransaction(ref(db,"temas/"+t.id+"/votos"),v=>(v||0)+1);
      lockVote();
      alert("Gracias por votar. Volvé mañana.");
    };

    list.appendChild(row);
  });
});
</script>

</body>
</html>
