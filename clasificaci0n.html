<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ranking ON!</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('fondoranking.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
}

/* Logo */
.logo {
    text-align: center;
    margin: 20px 0;
}

/* Título */
.titulo-ranking {
    text-align: center;
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 25px;
}

/* Renglón de tema */
.tema {
    display: flex;
    align-items: center;
    margin: 10px 20px;
    padding: 10px;
    background: rgba(0,0,0,0.5);
    border-radius: 10px;
    flex-wrap: wrap; /* permite que los elementos bajen en celulares */
}

.tema img {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    object-fit: cover;
    margin-right: 15px;
    flex-shrink: 0;
}

.info {
    flex: 1 1 150px; /* se adapta al espacio disponible */
    margin-right: 15px;
}

.info .nombre {
    font-size: 1.1em;
    font-weight: bold;
}

.info .artista {
    font-size: 0.9em;
    color: #ccc;
    word-wrap: break-word;
}

.controles {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 5px;
    flex-shrink: 0;
}

audio {
    width: 150px;
    max-width: 100%;
}

/* Botón rojo */
button {
    width: 70px;
    height: 35px;
    background-color: #ff0000;
    color: white;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

/* Media queries para móviles */
@media screen and (max-width: 600px) {
    .tema {
        flex-direction: column;
        align-items: flex-start;
    }
    .info {
        margin-right: 0;
        margin-top: 5px;
    }
    .controles {
        margin-top: 5px;
        flex-wrap: wrap;
        gap: 5px;
    }
    audio {
        width: 100%;
    }
    button {
        width: 100%;
    }
}
</style>
</head>
<body>

<!-- Logo -->
<div class="logo">
    <img src="logotipo.png" width="180" alt="ON! Radio Logo">
</div>

<!-- Título -->
<div class="titulo-ranking">
    Votá en el Ranking ON!
</div>

<!-- Lista de temas -->
<div id="lista-temas"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, get, update, child } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

// Configuración Firebase
const firebaseConfig = {
    apiKey: "AIzaSyC8XXef5k8hLmNL8ufIJsc7Sx5KTlRFdH8",
    authDomain: "on-radio-ranking.firebaseapp.com",
    databaseURL: "https://on-radio-ranking-default-rtdb.firebaseio.com",
    projectId: "on-radio-ranking",
    storageBucket: "on-radio-ranking.firebasestorage.app",
    messagingSenderId: "311635352358",
    appId: "1:311635352358:web:257ff4821987f07d31ffe7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const listaRef = ref(db, 'temas');

// Mostrar temas
function cargarTemas() {
    get(listaRef).then((snapshot) => {
        const data = snapshot.val();
        const contenedor = document.getElementById('lista-temas');
        contenedor.innerHTML = '';

        const temasArray = Object.entries(data).sort(() => Math.random() - 0.5); // aleatorio

        temasArray.forEach(([key, tema]) => {
            const div = document.createElement('div');
            div.className = 'tema';
            div.innerHTML = `
                <img src="${tema.imagen}" alt="${tema.nombre}">
                <div class="info">
                    <div class="nombre">${tema.nombre}</div>
                    <div class="artista">${tema.artista}</div>
                </div>
                <div class="controles">
                    <audio controls>
                        <source src="${tema.audio}" type="audio/mpeg">
                        Tu navegador no soporta audio.
                    </audio>
                    <button onclick="votar('${key}')">Votar</button>
                </div>
            `;
            contenedor.appendChild(div);
        });
    });
}

// Función votar
function votar(key) {
    const hoy = new Date().toISOString().split('T')[0];
    const votadoHoy = localStorage.getItem('votado_' + key);

    if(votadoHoy === hoy){
        alert("Ya votaste hoy este tema. Volvé mañana para votar de nuevo.");
        return;
    }

    const temaRef = child(listaRef, key);
    get(temaRef).then((snapshot) => {
        const tema = snapshot.val();
        if(!tema) return;
        const nuevosVotos = (tema.votos || 0) + 1;
        update(temaRef, { votos: nuevosVotos }).then(() => {
            alert("Gracias por votar tu tema preferido.\nRecordá que podés votar una sola vez por día.\nVolvé mañana para votar otra vez.");
            localStorage.setItem('votado_' + key, hoy);
        });
    });
}

// Iniciar
cargarTemas();
</script>

</body>
</html>
