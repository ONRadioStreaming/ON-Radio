<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ranking ON</title>

<link href="https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Montserrat, sans-serif;
  color:#fff;
  background:
    linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.75)),
    url("fondoranking2.jpg") center/cover no-repeat fixed;
}

.rank-fixed{
  position:fixed;
  left:12px;
  top:50%;
  transform:translateY(-50%) rotate(180deg);
  writing-mode:vertical-rl;
  font-family:Anton;
  font-size:48px;
  letter-spacing:8px;
  color:#fff;
  opacity:.15;
  pointer-events:none;
}

.header{
  text-align:center;
  padding:30px 10px 20px;
  position:relative;
}

.logo{
  position:absolute;
  right:15px;
  top:20px;
  width:90px;
}

.title{
  font-family:Anton;
  font-size:36px;
  color:#1fd5e6;
  letter-spacing:3px;
  margin:0;
}

.arrow{
  width:0;height:0;
  border-left:10px solid transparent;
  border-right:10px solid transparent;
  border-top:16px solid #1fd5e6;
  margin:10px auto 0;
}

.list{
  max-width:900px;
  margin:20px auto 40px;
  padding-left:70px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

.row{
  display:grid;
  grid-template-columns:60px 55px 1fr 110px;
  align-items:center;
  gap:10px;
  background:rgba(0,0,0,.55);
  padding:15px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.08);
}

.num{
  font-family:Anton;
  font-size:42px;
  text-align:center;
}

.row.top1 .num{
  color:#ff2b2b;
  font-size:50px;
}

.play{
  width:44px;
  height:44px;
  border-radius:50%;
  border:2px solid #fff;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.play svg{
  fill:#fff;
  width:18px;
}

.info .song{
  font-weight:900;
  font-size:20px;
  margin:0 0 4px 0;
}

.info .artist{
  font-size:14px;
  margin:0;
  color:rgba(255,255,255,.75);
}

.vote{
  background:#e10000;
  border:0;
  color:#fff;
  font-weight:900;
  border-radius:12px;
  height:44px;
  cursor:pointer;
}

.vote:disabled{
  opacity:.4;
  cursor:not-allowed;
}

.footer{
  text-align:center;
  padding:20px;
  font-weight:700;
  opacity:.8;
}
</style>
</head>
<body>

<div class="rank-fixed">RANKING ON</div>

<div class="header">
  <img src="logotipo.png" class="logo">
  <h1 class="title">VOTÁ TU TEMA PREFERIDO</h1>
  <div class="arrow"></div>
</div>

<div class="list" id="list"></div>

<div class="footer">www.laonradio.com.ar</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC8XXef5k8hLmNL8ufIJsc7Sx5KTlRFdH8",
  authDomain: "on-radio-ranking.firebaseapp.com",
  databaseURL: "https://on-radio-ranking-default-rtdb.firebaseio.com",
  projectId: "on-radio-ranking",
  storageBucket: "on-radio-ranking.appspot.com",
  messagingSenderId: "311635352358",
  appId: "1:311635352358:web:257ff4821987f07d31ffe7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const temasRef = ref(db,"temas");
const list = document.getElementById("list");
const audio = new Audio();

function today(){
  return new Date().toISOString().slice(0,10);
}

function votedToday(){
  return localStorage.getItem("on_vote") === today();
}

function lockVote(){
  localStorage.setItem("on_vote", today());
}

onValue(temasRef,(snap)=>{
  const data = snap.val();
  if(!data) return;

  const temas = Object.entries(data).map(([id,t])=>({
    id,
    nombre:t.nombre,
    artista:t.artista,
    audio:t.audio,
    votos:Number(t.votos||0)
  }));

  temas.sort((a,b)=>b.votos - a.votos);

  list.innerHTML="";

  temas.forEach((t,i)=>{
    const row=document.createElement("div");
    row.className="row"+(i===0?" top1":"");

    row.innerHTML=`
      <div class="num">${i+1}</div>
      <div class="play">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </div>
      <div class="info">
        <p class="song">${t.nombre}</p>
        <p class="artist">${t.artista}</p>
      </div>
      <button class="vote" ${votedToday()?"disabled":""}>VOTAR</button>
    `;

    row.querySelector(".play").onclick=()=>{
      audio.src = t.audio;
      audio.play();
    };

    row.querySelector(".vote").onclick=async ()=>{
      if(votedToday()) return alert("Ya votaste hoy. Volvé mañana.");
      await runTransaction(ref(db,"temas/"+t.id+"/votos"), v=> (v||0)+1);
      lockVote();
      alert("Gracias por votar. Podés volver mañana.");
    };

    list.appendChild(row);
  });
});
</script>
</body>
</html>
