<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ranking ON Radio</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('fondoranking.jpg') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    header {
      text-align: center;
      padding: 20px 0;
    }
    header img {
      width: 250px; /* mismo tamaño que la página principal */
    }
    header h1 {
      margin: 10px 0 20px 0;
      font-size: 2em;
      font-weight: bold;
    }
    .tema {
      display: flex;
      align-items: center;
      background: rgba(0,0,0,0.5);
      margin: 10px auto;
      padding: 10px;
      border-radius: 10px;
      max-width: 700px;
      flex-wrap: wrap;
    }
    .tema img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      margin-right: 15px;
      border-radius: 5px;
    }
    .info {
      flex: 1;
      min-width: 180px;
    }
    .info .nombre {
      font-weight: bold;
      font-size: 1.1em;
    }
    .info .artista {
      font-size: 0.95em;
    }
    .player-votar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }
    audio {
      width: 200px;
    }
    .boton-votar {
      background-color: red;
      color: white;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    footer {
      background: rgba(0,0,0,0.6);
      text-align: center;
      padding: 10px 0;
      font-size: 0.9em;
    }
    footer div {
      margin: 2px 0;
    }
    @media (max-width: 500px) {
      .tema {
        flex-direction: column;
        align-items: flex-start;
      }
      .player-votar {
        width: 100%;
        justify-content: space-between;
      }
      audio {
        width: 60%;
      }
    }
  </style>
</head>
<body>

<header>
  <img src="logotipo.png" alt="Logo ON Radio">
  <h1>Votá en el Ranking ON</h1>
</header>

<div id="lista-temas"></div>

<footer>
  <div>Derechos reservados a ON Radio</div>
  <div>Dale ON a la música que más te gusta!</div>
</footer>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC8XXef5k8hLmNL8ufIJsc7Sx5KTlRFdH8",
    authDomain: "on-radio-ranking.firebaseapp.com",
    databaseURL: "https://on-radio-ranking-default-rtdb.firebaseio.com",
    projectId: "on-radio-ranking",
    storageBucket: "on-radio-ranking.firebasestorage.app",
    messagingSenderId: "311635352358",
    appId: "1:311635352358:web:257ff4821987f07d31ffe7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const temasRef = ref(db, 'temas'); // <-- cambiamos la referencia al nodo correcto

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  onValue(temasRef, (snapshot) => {
    const temas = snapshot.val();
    const lista = document.getElementById('lista-temas');
    lista.innerHTML = '';

    if (!temas) return;

    const keys = Object.keys(temas);
    shuffleArray(keys); // Orden aleatorio

    keys.forEach(key => {
      const tema = temas[key];

      const divTema = document.createElement('div');
      divTema.classList.add('tema');

      divTema.innerHTML = `
        <img src="${tema.imagen}" alt="${tema.nombre}">
        <div class="info">
          <div class="nombre">${tema.nombre}</div>
          <div class="artista">${tema.artista}</div>
          <div class="player-votar">
            <audio controls src="${tema.audio}"></audio>
            <button class="boton-votar">Votar</button>
          </div>
        </div>
      `;

      const btnVotar = divTema.querySelector('.boton-votar');
      btnVotar.addEventListener('click', () => {
        alert("Gracias por votar tu tema preferido. Recordá que podés votar una sola vez por día. Volvé mañana para votar otra vez.");
        // Opcional: actualizar votos en Firebase
        const votosActuales = tema.votos || 0;
        update(ref(db, temas/${key}), { votos: votosActuales + 1 });
      });

      lista.appendChild(divTema);
    });
  });

</script>

</body>
</html>
