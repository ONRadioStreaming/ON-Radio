<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ranking ON!</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: url('fondoranking.jpg') no-repeat center center fixed;
        background-size: cover;
        color: #fff;
    }
    .logo {
        text-align: center;
        margin: 20px 0;
    }
    .tema {
        display: flex;
        align-items: center;
        margin: 10px 20px;
        padding: 10px;
        background: rgba(0,0,0,0.5);
        border-radius: 10px;
    }
    .tema img {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        margin-right: 15px;
        object-fit: cover;
    }
    .info {
        flex: 1;
    }
    .info .nombre {
        font-size: 1.1em;
        font-weight: bold;
    }
    .info .artista {
        font-size: 0.9em;
        color: #ccc;
    }
    .controles {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    button {
        padding: 5px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background-color: #ff5722;
        color: white;
        font-weight: bold;
    }
</style>
</head>
<body>

<div class="logo">
    <img src="logotipo.png" alt="ON! Radio Logo" style="height:80px;">
</div>

<div id="lista-temas"></div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

// Configuración Firebase
const firebaseConfig = {
    apiKey: "AIzaSyC8XXef5k8hLmNL8ufIJsc7Sx5KTlRFdH8",
    authDomain: "on-radio-ranking.firebaseapp.com",
    databaseURL: "https://on-radio-ranking-default-rtdb.firebaseio.com",
    projectId: "on-radio-ranking",
    storageBucket: "on-radio-ranking.firebasestorage.app",
    messagingSenderId: "311635352358",
    appId: "1:311635352358:web:257ff4821987f07d31ffe7"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const listaRef = ref(db, 'temas');

// Función para leer y mostrar los temas
function cargarTemas() {
    onValue(listaRef, (snapshot) => {
        const data = snapshot.val();
        const contenedor = document.getElementById('lista-temas');
        contenedor.innerHTML = '';

        // Convertir objeto en array y ordenar por votos descendentes
        const temasArray = Object.entries(data).sort((a,b) => b[1].votos - a[1].votos);

        temasArray.forEach(([key, tema]) => {
            const div = document.createElement('div');
            div.className = 'tema';
            div.innerHTML = `
                <img src="${tema.imagen}" alt="${tema.nombre}">
                <div class="info">
                    <div class="nombre">${tema.nombre}</div>
                    <div class="artista">${tema.artista}</div>
                </div>
                <div class="controles">
                    <audio controls>
                        <source src="${tema.audio}" type="audio/mpeg">
                        Tu navegador no soporta audio.
                    </audio>
                    <button onclick="votar('${key}')">Votar</button>
                </div>
            `;
            contenedor.appendChild(div);
        });
    });
}

// Función para votar
function votar(key) {
    const hoy = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
    const votadoHoy = localStorage.getItem('votado_' + key);

    if(votadoHoy === hoy){
        alert("Ya votaste hoy este tema. Volvé mañana para votar de nuevo.");
        return;
    }

    const temaRef = ref(db, 'temas/' + key);
    onValue(temaRef, (snapshot) => {
        const tema = snapshot.val();
        if(!tema) return;
        const nuevosVotos = (tema.votos || 0) + 1;
        update(temaRef, { votos: nuevosVotos }).then(() => {
            alert("Gracias por votar tu tema preferido.\nRecordá que podés votar una sola vez por día.\nVolvé mañana para votar otra vez.");
            localStorage.setItem('votado_' + key, hoy);
        });
    }, { onlyOnce: true });
}

// Cargar temas al inicio
cargarTemas();
</script>

</body>
</html>
